{{- if eq .Values.server.trust.type "remote" }}

apiVersion: v1
kind: Service
metadata:
  name: notary-signer
spec:
  ports:
  - name: https
    port: {{ .Values.signer.port }}
    targetPort: {{ .Values.signer.port }}
  selector:
    app.kubernetes.io/name: notary
    app.kubernetes.io/component: notary-signer

---

{{- end }}

apiVersion: v1
kind: Service
metadata:
  name: notary-server
spec:
  ports:
  - name: https
    port: {{ .Values.server.port }}
    targetPort: {{ .Values.server.port }}
  selector:
    app.kubernetes.io/name: notary
    app.kubernetes.io/component: notary-server
  {{- if .Values.loadBalancer.enabled }}
  type: LoadBalancer
  {{- if .Values.loadBalancer.loadBalancerIP }}
  loadBalancerIP: {{ .Values.loadBalancer.loadBalancerIP }}
  {{- end }}
  {{- end }}


---

{{- if (and .Values.storage.enabled (not (eq .Values.storage.flavor "memory"))) }}

apiVersion: v1
kind: Service
metadata:
  name: notary-db
spec:
  ports:
  {{- if eq .Values.storage.flavor "mysql" }}
  - name: mysql
    port: 3306
    targetPort: 3306
  {{- else if eq .Values.storage.flavor "postgres" }}
  - name: postgres
    port: 5432
    targetPort: 5432
  {{- end }}
  selector:
    app.kubernetes.io/name: notary
    app.kubernetes.io/component: notary-db

{{- end }}